import{x as A,r as o,a$ as V,a as G,bI as O,d as e,bK as J,ci as Q,cK as z,b7 as R,Q as X,b as q,cT as Y,S as F,cU as K,y as Z,cV as ee,cW as ae,ag as te,a6 as se,av as re,aH as oe,aI as ne,aF as le,aJ as ce,cX as ie,e as b,N as L,f as D,bl as _,aL as me,h as $,aM as he,ai as B,L as ue,M as de,T as pe,an as ge,G as W}from"./index-COK8v4JT.js";import{T as fe}from"./TeamCard-CJUGt6SH.js";import{U as P}from"./Upload-QKeYiYEY.js";import"./useTeamChar-Cpx1K0_M.js";import"./TeamDelModal-ClC9rDKb.js";function ye({teamIds:s,charKeys:r,setCharKey:m,acProps:l}){const{t:h}=A(["page_team","sillyWisher_charNames","charNames_gen"]),{silly:f}=o.useContext(V),n=G(),{gender:u}=O(),d=o.useCallback(a=>n.charMeta.get(a).favorite,[n.charMeta]),v=o.useCallback(a=>e(J,{characterKey:a}),[]),w=o.useCallback((a,c)=>h(`${c?"sillyWisher_charNames":"charNames_gen"}:${Q(a,u)}`),[u,h]),S=q,p=z(n.chars),{characterTeamTotal:g}=o.useMemo(()=>R({characterTeamTotal:p},c=>{n.teams.values.forEach(y=>{const{loadoutData:i}=y;i.filter(K).forEach(({teamCharId:k})=>{const T=n.teamChars.get(k);if(!T)return;const x=T.key;c.characterTeamTotal[x].total++})}),s.forEach(y=>{const i=n.teams.get(y);if(!i)return;const{loadoutData:k}=i;k.filter(K).forEach(({teamCharId:T})=>{const x=n.teamChars.get(T);if(!x)return;const E=x.key;c.characterTeamTotal[E].current++})})}),[n,p,s]),I=o.useCallback(a=>e("strong",{children:g[a]}),[g]),M=o.useCallback(a=>e(X,{size:"small",label:g[a]}),[g]),N=o.useMemo(()=>p.map(a=>({key:a,label:w(a,f),alternateNames:f?[w(a,!f)]:void 0,favorite:d(a),color:S(a)})).sort((a,c)=>a.favorite&&!c.favorite?-1:!a.favorite&&c.favorite?1:a.label.localeCompare(c.label)),[f,w,S,d,p]);return e(o.Suspense,{fallback:e(F,{variant:"text",width:100}),children:e(Y,{label:h("searchLabel.char"),options:N,toImg:v,valueKeys:r,onChange:a=>m(a),toExLabel:I,toExItemLabel:M,chipProps:{variant:"outlined"},...l})})}function Te(){return{name:s=>s.name??"",lastEdit:s=>s.lastEdit??0}}const Ce={name:["name","lastEdit"],lastEdit:["lastEdit"]};function xe(s){return{charKeys:(r,m)=>{var n;if(!m.length)return!0;const l=(n=s.teams.get(r))==null?void 0:n.loadoutData.filter(K),h=l==null?void 0:l.map(({teamCharId:u})=>{var d;return(d=s.teamChars.get(u))==null?void 0:d.key}).filter(K);return m.every(u=>h==null?void 0:h.includes(u))},name:(r,m)=>{var l;return!m||!!((l=s.teams.get(r))!=null&&l.name.toLowerCase().includes(m.toLowerCase()))}}}const be={xs:1,sm:2,md:3,lg:4,xl:5},ve={xs:6,sm:12,md:18,lg:24,xl:30};function Me(){const{t:s}=A(["page_team","page_teams","sillyWisher_charNames","charNames_gen"]),r=G(),m=Z(),l=ee();ae();const h=()=>{const t=r.teams.new();m(t)},[f,n,u]=te(),[d,v]=o.useState("");o.useEffect(()=>{var t,C;(t=l.state)!=null&&t.openImportModal&&(v((C=l.state)==null?void 0:C.teamData),n())},[l.state,n,v]);const w=()=>{try{const t=JSON.parse(d);r.teams.import(t)||window.alert(s("importForm.error.verifi")),u()}catch(t){window.alert(s("importForm.error.import")+`
${t}`);return}},S=se(r.displayTeam),{sortType:p,ascending:g,charKeys:I}=S,[M,N]=o.useState(S.searchTerm),a=o.useDeferredValue(M);o.useEffect(()=>{r.displayTeam.set({searchTerm:a})},[r,a]);const c=re(r.teams),y=c.length,i=o.useMemo(()=>c&&r.teams.keys.filter(oe({charKeys:I,name:a},xe(r))).sort((t,C)=>ne(Ce[p],g,Te())(r.teams.get(t),r.teams.get(C))),[c,r,I,a,p,g]),k=le(),{numShow:T,setTriggerElement:x}=ce(ve[k],i.length),E=o.useMemo(()=>i.slice(0,T),[i,T]),j=i.length!==y?`${i.length}/${y}`:`${y}`,H={numShowing:E.length,total:j,t:s,namespace:"page_teams"},U={sortKeys:[...ie],value:p,onChange:t=>r.displayTeam.set({sortType:t}),ascending:g,onChangeAsc:t=>r.displayTeam.set({ascending:t})};return b(D,{display:"flex",flexDirection:"column",gap:1,children:[e($,{children:b(L,{sx:{display:"flex",flexDirection:"column",gap:1},children:[b(D,{display:"flex",gap:1,alignItems:"stretch",children:[e(ye,{teamIds:i,charKeys:I,setCharKey:t=>r.displayTeam.set({charKeys:t}),acProps:{sx:{flexGrow:1}}}),e(_,{autoFocus:!0,value:M,onChange:t=>N(t.target.value),label:s("searchLabel.team"),sx:{height:"100%",flexGrow:1},InputProps:{sx:{height:"100%"}}})]}),e(D,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:e(me,{showingTextProps:H,sortByButtonProps:U})})]})}),b(D,{sx:{display:"flex",gap:1},children:[e(B,{fullWidth:!0,onClick:h,color:"info",startIcon:e(he,{}),children:s("addTeamBtn")}),e(ge,{open:f,onClose:u,children:b($,{children:[e(ue,{title:s("importForm.title")}),e(de,{}),b(L,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e(pe,{children:s("importForm.desc")}),e(_,{fullWidth:!0,label:s("importForm.label"),placeholder:s("importForm.placeholder"),value:d,onChange:t=>v(t.target.value),multiline:!0,rows:4}),e(B,{startIcon:e(P,{}),disabled:!d,onClick:w,children:s("importForm.importBtn")})]})]})}),e(B,{fullWidth:!0,onClick:n,color:"info",startIcon:e(P,{}),children:s("importTeamBtn")})]}),e(o.Suspense,{fallback:e(F,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:5e3}}),children:e(W,{container:!0,spacing:2,columns:be,children:E.map(t=>e(W,{item:!0,xs:1,children:e(o.Suspense,{fallback:e(F,{variant:"rectangular",width:"100%",height:150}),children:e(fe,{teamId:t,bgt:"light",onClick:C=>m(`${t}${C?`/${C}`:""}`)})})},t))})}),i.length!==E.length&&e(F,{ref:t=>{t&&x(t)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})}export{Me as default};
