import{x as G,r as o,b3 as U,a as A,bM as V,d as e,bO as Q,cm as z,cO as J,bb as R,Q as X,b as Y,cX as Z,S as F,cY as K,y as q,cZ as ee,c_ as ae,ah as te,a6 as se,aw as re,aK as oe,aL as ne,aG as le,aM as ce,e as b,N as B,f as D,bp as L,aO as ie,c$ as me,h as $,aP as he,aj as _,L as ue,M as de,T as pe,ao as ge,G as P}from"./index-D0UoU9lj.js";import{T as fe}from"./TeamCard-CY5OdCsW.js";import{U as W}from"./Upload-B1eVZiLj.js";import"./useTeamChar-DTziLmGl.js";import"./TeamDelModal-gNfyK5O6.js";function ye({teamIds:s,charKeys:r,setCharKey:m,acProps:l}){const{t:h}=G(["page_team","sillyWisher_charNames","charNames_gen"]),{silly:f}=o.useContext(U),n=A(),{gender:u}=V(),d=o.useCallback(a=>n.charMeta.get(a).favorite,[n.charMeta]),w=o.useCallback(a=>e(Q,{characterKey:a}),[]),S=o.useCallback((a,c)=>h(`${c?"sillyWisher_charNames":"charNames_gen"}:${z(a,u)}`),[u,h]),v=Y,p=J(n.chars),{characterTeamTotal:g}=o.useMemo(()=>R({characterTeamTotal:p},c=>{n.teams.values.forEach(y=>{const{loadoutData:i}=y;i.filter(K).forEach(({teamCharId:M})=>{const C=n.teamChars.get(M);if(!C)return;const x=C.key;c.characterTeamTotal[x].total++})}),s.forEach(y=>{const i=n.teams.get(y);if(!i)return;const{loadoutData:M}=i;M.filter(K).forEach(({teamCharId:C})=>{const x=n.teamChars.get(C);if(!x)return;const k=x.key;c.characterTeamTotal[k].current++})})}),[n,p,s]),I=o.useCallback(a=>e("strong",{children:g[a]}),[g]),E=o.useCallback(a=>e(X,{size:"small",label:g[a]}),[g]),N=o.useMemo(()=>p.map(a=>({key:a,label:S(a,f),alternateNames:f?[S(a,!f)]:void 0,favorite:d(a),color:v(a)})).sort((a,c)=>a.favorite&&!c.favorite?-1:!a.favorite&&c.favorite?1:a.label.localeCompare(c.label)),[f,S,v,d,p]);return e(o.Suspense,{fallback:e(F,{variant:"text",width:100}),children:e(Z,{label:h("searchLabel.char"),options:N,toImg:w,valueKeys:r,onChange:a=>m(a),toExLabel:I,toExItemLabel:E,chipProps:{variant:"outlined"},...l})})}function Ce(){return{name:s=>s.name??"",lastEdit:s=>s.lastEdit??0}}const Te={name:["name","lastEdit"],lastEdit:["lastEdit"]};function xe(s){return{charKeys:(r,m)=>{var n;if(!m.length)return!0;const l=(n=s.teams.get(r))==null?void 0:n.loadoutData.filter(K),h=l==null?void 0:l.map(({teamCharId:u})=>{var d;return(d=s.teamChars.get(u))==null?void 0:d.key}).filter(K);return m.every(u=>h==null?void 0:h.includes(u))},name:(r,m)=>{var l;return!m||!!((l=s.teams.get(r))!=null&&l.name.toLowerCase().includes(m.toLowerCase()))}}}const be={xs:1,sm:2,md:3,lg:4,xl:5},we={xs:6,sm:12,md:18,lg:24,xl:30};function Ee(){const{t:s}=G(["page_team","page_teams","sillyWisher_charNames","charNames_gen"]),r=A(),m=q(),l=ee();ae();const h=()=>{const t=r.teams.new();m(t)},[f,n,u]=te(),[d,w]=o.useState("");o.useEffect(()=>{var t,T;(t=l.state)!=null&&t.openImportModal&&(w((T=l.state)==null?void 0:T.teamData),n())},[l.state,n,w]);const S=()=>{try{const t=JSON.parse(d);r.teams.import(t)||window.alert(s("importForm.error.verifi")),u()}catch(t){window.alert(s("importForm.error.import")+`
${t}`);return}},v=se(r.displayTeam),{sortType:p,ascending:g,charKeys:I}=v,[E,N]=o.useState(v.searchTerm),a=o.useDeferredValue(E);o.useEffect(()=>{r.displayTeam.set({searchTerm:a})},[r,a]);const c=re(r.teams),y=c.length,i=o.useMemo(()=>c&&r.teams.keys.filter(oe({charKeys:I,name:a},xe(r))).sort((t,T)=>ne(Te[p],g,Ce())(r.teams.get(t),r.teams.get(T))),[c,r,I,a,p,g]),M=le(),{numShow:C,setTriggerElement:x}=ce(we[M],i.length),k=o.useMemo(()=>i.slice(0,C),[i,C]),O=i.length!==y?`${i.length}/${y}`:`${y}`,j={numShowing:k.length,total:O,t:s,namespace:"page_teams"},H={sortKeys:[...me],value:p,onChange:t=>r.displayTeam.set({sortType:t}),ascending:g,onChangeAsc:t=>r.displayTeam.set({ascending:t})};return b(D,{display:"flex",flexDirection:"column",gap:1,children:[e($,{children:b(B,{sx:{display:"flex",flexDirection:"column",gap:1},children:[b(D,{display:"flex",gap:1,alignItems:"stretch",children:[e(ye,{teamIds:i,charKeys:I,setCharKey:t=>r.displayTeam.set({charKeys:t}),acProps:{sx:{flexGrow:1}}}),e(L,{autoFocus:!0,value:E,onChange:t=>N(t.target.value),label:s("searchLabel.team"),sx:{height:"100%",flexGrow:1},InputProps:{sx:{height:"100%"}}})]}),e(D,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:e(ie,{showingTextProps:j,sortByButtonProps:H})})]})}),b(D,{sx:{display:"flex",gap:1},children:[e(_,{fullWidth:!0,onClick:h,color:"info",startIcon:e(he,{}),children:s("addTeamBtn")}),e(ge,{open:f,onClose:u,children:b($,{children:[e(ue,{title:s("importForm.title")}),e(de,{}),b(B,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e(pe,{children:s("importForm.desc")}),e(L,{fullWidth:!0,label:s("importForm.label"),placeholder:s("importForm.placeholder"),value:d,onChange:t=>w(t.target.value),multiline:!0,rows:4}),e(_,{startIcon:e(W,{}),disabled:!d,onClick:S,children:s("importForm.importBtn")})]})]})}),e(_,{fullWidth:!0,onClick:n,color:"info",startIcon:e(W,{}),children:s("importTeamBtn")})]}),e(o.Suspense,{fallback:e(F,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:5e3}}),children:e(P,{container:!0,spacing:2,columns:be,children:k.map(t=>e(P,{item:!0,xs:1,children:e(o.Suspense,{fallback:e(F,{variant:"rectangular",width:"100%",height:150}),children:e(fe,{teamId:t,bgt:"light",onClick:T=>m(`${t}${T?`/${T}`:""}`)})})},t))})}),i.length!==k.length&&e(F,{ref:t=>{t&&x(t)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})}export{Ee as default};
